<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
  <preference for="Paytrail\PaymentService\Api\RedirectInterface" type="Paytrail\PaymentService\Model\Redirect" />
  <type name="Magento\Tax\Model\Config">
    <plugin name="paytrail_payment_service_tax_config_plugin" type="Paytrail\PaymentService\Plugin\Model\TaxConfigPlugin" sortOrder="1" disabled="false" />
  </type>
  <virtualType name="SalesOrderViewWidgetContext" type="\Magento\Backend\Block\Widget\Context">
    <arguments>
      <argument name="buttonList" xsi:type="object">Paytrail\PaymentService\Block\Adminhtml\Order\View\ButtonList</argument>
    </arguments>
  </virtualType>
  <type name="Magento\Sales\Block\Adminhtml\Order\View">
    <arguments>
      <argument name="context" xsi:type="object">SalesOrderViewWidgetContext</argument>
    </arguments>
  </type>

  <virtualType name="PaytrailAdapter" type="Magento\Payment\Model\Method\Adapter">
    <arguments>
      <argument name="code" xsi:type="const">Paytrail\PaymentService\Model\ConfigProvider::CODE</argument>
      <argument name="formBlockType" xsi:type="string">Paytrail\PaymentService\Block\Form\Checkout</argument>
      <argument name="infoBlockType" xsi:type="string">Paytrail\PaymentService\Block\Info\Checkout</argument>
      <argument name="valueHandlerPool" xsi:type="object">PaytrailValueHandlerPool</argument>
      <argument name="commandPool" xsi:type="object">PaytrailCommandPool</argument>
      <argument name="validatorPool" xsi:type="object">PaytrailValidatorPool</argument>
    </arguments>
  </virtualType>


  <virtualType name="PaytrailConfig" type="Magento\Payment\Gateway\Config\Config">
    <arguments>
      <argument name="methodCode" xsi:type="const">Paytrail\PaymentService\Model\ConfigProvider::CODE</argument>
    </arguments>
  </virtualType>
  <virtualType name="PaytrailConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
    <arguments>
      <argument name="configInterface" xsi:type="object">PaytrailConfig</argument>
    </arguments>
  </virtualType>
  <virtualType name="PaytrailValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
    <arguments>
      <argument name="handlers" xsi:type="array">
        <item name="default" xsi:type="string">PaytrailConfigValueHandler</item>
      </argument>
    </arguments>
  </virtualType>

  <virtualType name="PaytrailCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
    <arguments>
      <argument name="commands" xsi:type="array">
        <item name="initialize" xsi:type="string">Paytrail\PaymentService\Gateway\Command\Initialize</item>
        <item name="refund" xsi:type="string">PaytrailRefundCommand</item>
      </argument>
    </arguments>
  </virtualType>

  <virtualType name="PaytrailRefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
    <arguments>
      <argument name="requestBuilder" xsi:type="object">PaytrailRefundRequest</argument>
      <argument name="transferFactory" xsi:type="object">Paytrail\PaymentService\Gateway\Http\TransferFactory</argument>
      <argument name="client" xsi:type="object">Paytrail\PaymentService\Gateway\Http\Client\TransactionRefund</argument>
      <argument name="validator" xsi:type="object">Paytrail\PaymentService\Gateway\Validator\RefundResponseValidator</argument>
      <argument name="handler" xsi:type="object">Paytrail\PaymentService\Gateway\Response\RefundHandler</argument>
    </arguments>
  </virtualType>

  <virtualType name="PaytrailRefundRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
    <arguments>
      <argument name="builders" xsi:type="array">
        <item name="refund" xsi:type="string">Paytrail\PaymentService\Gateway\Request\RefundDataBuilder</item>
      </argument>
    </arguments>
  </virtualType>

  <virtualType name="PaytrailCountryValidator" type="Paytrail\PaymentService\Gateway\Validator\CountryValidator">
    <arguments>
      <argument name="config" xsi:type="object">Paytrail\PaymentService\Gateway\Config\Config</argument>
    </arguments>
  </virtualType>
  <virtualType name="PaytrailValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
    <arguments>
      <argument name="validators" xsi:type="array">
        <item name="country" xsi:type="string">PaytrailCountryValidator</item>
      </argument>
    </arguments>
  </virtualType>

  <type name="Paytrail\PaymentService\Logger\Request\Request">
    <arguments>
      <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
    </arguments>
  </type>
  <type name="Paytrail\PaymentService\Logger\Request\RequestLogger">
    <arguments>
      <argument name="name" xsi:type="string">Paytrail Request Logger</argument>
      <argument name="handlers"  xsi:type="array">
        <item name="debug" xsi:type="object">Paytrail\PaymentService\Logger\Request\Request</item>
      </argument>
    </arguments>
  </type>

  <type name="Paytrail\PaymentService\Logger\Response\Response">
    <arguments>
      <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
    </arguments>
  </type>
  <type name="Paytrail\PaymentService\Logger\Response\ResponseLogger">
    <arguments>
      <argument name="name" xsi:type="string">Paytrail Response Logger</argument>
      <argument name="handlers"  xsi:type="array">
        <item name="debug" xsi:type="object">Paytrail\PaymentService\Logger\Response\Response</item>
      </argument>
    </arguments>
  </type>
</config>
